# `0xd4` NG-Radio Station List

Radio `0x68` → GT `0x3b`  
GT `0x3b` → Radio `0x68`

The radio, more precisely the BM54 sends this command to the GT, containing stations.
For detailed info, see 'Use Cases'.

### Related

- `0x45` [Set Radio UI](../gt/45.md)

### Examples

    # No stations
    68 06 3B D4 03 00 00 82

    # 1 station, [MDR JUMP], selected: MDR JUMP
    68 0F 3B D4 03 01 00 4D 44 52 20 4A 55 4D 50 10 E3

    # 2 stations [MDR JUMP, ANT.THUE], selected: ANT.THUE
    68 18 3B D4 03 02 00 4D 44 52 20 4A 55 4D 50 00 41 4E 54 2E 54 48 55 45 10 8E

    # 3 stations [MDR JUMP, ANT.THUE, MDR THUE], selected: ANT.THUE
    68 21 3B D4 03 03 00 4D 44 52 20 4A 55 4D 50 00 41 4E 54 2E 54 48 55 45 10 4D 44 52 20 54 48 55 45 00 C1

    # 4 stations [MDR JUMP, ANT.THUE, MDR THUE, *TOP 40*], selected: *TOP 40*
    68 21 3B D4 03 04 00 4D 44 52 20 4A 55 4D 50 00 41 4E 54 2E 54 48 55 45 00 4D 44 52 20 54 48 55 45 00 D6
    68 0F 3B D4 03 04 01 2A 54 4F 50 20 34 30 2A 10 F1

    # Set station
    3B 05 68 D4 01 01 82  # Index 1    
    3B 05 68 D4 01 02 81  # Index 2

    # Acknowledge response
    3B 04 68 D4 02 81

## Parameters

Variable length. 3 control bytes, up to 3 null terminated strings.

| Parameter                                    | Index | Length              |
|:---------------------------------------------|:------|:--------------------|
| Message Type                                 | `0`   | `1`                 |
| Station Count                                | `1`   | `1`                 |
| Message Index                                | `2`   | `1`                 |
| Station String 1 (optional, with terminator) | `3`   | `up to 9 (8 chars)` |
| Station String 2 (optional, with terminator) | `x`   | `up to 9 (8 chars)` |
| Station String 3 (optional, with terminator) | `x`   | `up to 9 (8 chars)` |

### Message Type

Type of the message.

    ACK_RESPONSE      = 0x01  # Respond from GT after station list command.
    SET_STATION       = 0x02  # Command from GT on selecting a station in the list.
    STATION_LIST      = 0x03  # Message from Radio when focusing, changing station or station update.

### Station Count

The full count of stations in the list.

    68 21 3B D4 03 *03* ...   # 3 Stations
    68 0F 3B D4 03 *04* ...   # 4 Stations (must be split into multiple messages)

### Message Index

The station list must be split into multiple messages if there are more than 3 entries.\
One message can contain 3 stations.

    68 21 3B D4 03 04 *00* ...  # 4 Stations, Message Index 0 (containing 3 stations)
    68 0F 3B D4 03 04 *01* ...  # 4 Stations, Message Index 1 (containing 1 station)

### Station Strings

One message can contain up to 3 station strings.\
The length is capped to 9 bytes including the null terminator.\
This means, the value can be an 8 character string, congruent with the RDS standard.

The terminator also, more precisely bit 4, indicates to the GT which station is currently active.

    4D 44 52 20 4A 55 4D 50 *00*  # MDR JUMP
    41 4E 54 2E 54 48 55 45 *10*  # ANT.THUE, Selected
    4D 44 52 20 54 48 55 45 *00*  # MDR THUE

## Use Cases

You might be wondering why this exists?\
Isn't there already a perfectly fine station list, written by our beloved `0x21` command?\
And why is this only used by the BM54?

<details>
  <summary>A story about shoehorning an infotainment system</summary>

---

**POV:**\
The year is 2000, and you work at Siemens VDO in Wetzlar, Germany.\
It's a friday, actually a beautiful day, and you don't have much to do. Life is good, life is well.

Oh, Wait! You have one more meeting today with those pesky BMW executives, and you're already late!

At the meeting, the executives look at you with a straight and/or angry face (you can never quite tell).

They say 'Ve had ze idea to add a splitscreen zat iss more zan a zirt uff ze size uff ze schcreen'.\
*Translation: We had the idea to add a splitscreen that is more than a third of the size of the screen.*

You immediately realize all the problems that would result from this major operation.\
Like your beautiful carefully crafted `0x21` list command that the BM24 uses for its station list!\
That would never work with such a small screen!

But your boss says: "JA! Zat sounds like a great ideaa! Zat schouldn't be a big problem."

You immediately get to work, shoehorning new features into the operating system.
You're weekend is ruined.

</details>

---

#### TLDR

The contents are exclusively used in the FMD mode of the BM54.

The problem with the normal `0x21` command is that it was designed for a screen layout that could fit 10 list items.\
But the splitscreen view can only fit up to 6 items on a screen!\
That's fine for the business radios (BM23, BM53), because they only have to display 6 items at most, due to lack of a second tuner, and
therefore they don't support a full station list.

The professional radios (BM24, BM54¹) on the other hand write a full screen with stations and even a next button.\
It would be a very awkward UI if you would fit 10 items (including '>>') on a 6 items layout with a scrollbar.\
To resolve this issue, the NG-Radio Station List command was created.\
The GT buffers the station names and uses them to build an endless scrolling station list.\

This is the reason why the BM24 does not support the splitscreen view.\
You can tell the GT (MK3, MK4) that the radio is a BM54 via coding.\
But you will get the awkward UI that was explained above.

¹ Actually, the BM54 never uses the `0x21` command in FMD mode, even when the splitscreen is disabled.\
It is always using the buffered contents from `0xd4` and the next arrow '>>' is generated by the GT.
The only exception is if the "New UI" bit is not set in the `0x45` message. (When using an BM54 with the old UI.)

Last Fact: The `0x21` will just overwrite the NG-Radio station list.
More than 6 items will result in a scrollbar.

![Station List](d4/station_list.jpg)  






